// Claude „É¢„Éº„ÉâÂà∂Âæ°Ê©üËÉΩ
// Claude„ÅÆÂêÑÁ®ÆÁâπÊÆä„É¢„Éº„ÉâÔºàProjects„ÄÅArtifacts„ÄÅ„É¢„Éá„É´ÈÅ∏Êäû„Å™„Å©Ôºâ„ÇíÂà∂Âæ°

(() => {
  "use strict";

  console.log("[11.autoai][Claude] „É¢„Éº„ÉâÂà∂Âæ°Ê©üËÉΩ„ÇíË™≠„ÅøËæº„Åø‰∏≠...");

  // ===== „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞ =====

  function sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }

  function waitForElement(selector, timeout = 5000) {
    return new Promise((resolve, reject) => {
      const startTime = Date.now();
      const checkElement = () => {
        const element = document.querySelector(selector);
        if (element) {
          resolve(element);
        } else if (Date.now() - startTime > timeout) {
          reject(new Error(`Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: ${selector}`));
        } else {
          setTimeout(checkElement, 100);
        }
      };
      checkElement();
    });
  }

  // ===== Claude ProjectsÊ©üËÉΩÂà∂Âæ° =====

  async function enableClaudeProjects() {
    console.log("[11.autoai][Claude] üìÅ Projects„É¢„Éº„Éâ„ÇíÊúâÂäπÂåñ‰∏≠...");

    try {
      // Projects„Éú„Çø„É≥„ÇíÊé¢„Åô
      const projectButton = Array.from(
        document.querySelectorAll("button, a"),
      ).find(
        (el) =>
          el.textContent?.includes("Projects") ||
          el.textContent?.includes("Project"),
      );

      if (projectButton) {
        console.log("[11.autoai][Claude] üìÅ Projects„Éú„Çø„É≥„ÇíÈÅ∏Êäû");
        projectButton.click();
        await sleep(500);
        console.log("[11.autoai][Claude] ‚úÖ Projects„É¢„Éº„Éâ„ÅåÊúâÂäπ„Å´„Å™„Çä„Åæ„Åó„Åü");
        return true;
      } else {
        console.warn("[11.autoai][Claude] ‚ùå Projects„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");
        return false;
      }
    } catch (error) {
      console.error("[11.autoai][Claude] ProjectsÊúâÂäπÂåñ„Ç®„É©„Éº:", error);
      return false;
    }
  }

  async function disableClaudeProjects() {
    console.log("[11.autoai][Claude] üìÅ Projects„É¢„Éº„Éâ„ÇíÁÑ°ÂäπÂåñ‰∏≠...");

    try {
      // ÈÄöÂ∏∏„ÅÆ„ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢„Å´Êàª„Çã„Éú„Çø„É≥„ÇíÊé¢„Åô
      const chatButton = Array.from(
        document.querySelectorAll("button, a"),
      ).find(
        (el) =>
          el.textContent?.includes("Chat") ||
          el.textContent?.includes("New chat"),
      );

      if (chatButton) {
        chatButton.click();
        await sleep(500);
        console.log("[11.autoai][Claude] ‚úÖ ÈÄöÂ∏∏„ÅÆ„ÉÅ„É£„ÉÉ„Éà„É¢„Éº„Éâ„Å´Êàª„Åó„Åæ„Åó„Åü");
        return true;
      }
      return false;
    } catch (error) {
      console.error("[11.autoai][Claude] ProjectsÁÑ°ÂäπÂåñ„Ç®„É©„Éº:", error);
      return false;
    }
  }

  // ===== Claude ArtifactsÊ©üËÉΩÂà∂Âæ° =====

  async function enableClaudeArtifacts() {
    console.log("[11.autoai][Claude] üõ†Ô∏è Artifacts„É¢„Éº„Éâ„ÇíÊúâÂäπÂåñ‰∏≠...");

    try {
      // Artifacts„ÅØÈÄöÂ∏∏Ëá™ÂãïÁöÑ„Å´ÊúâÂäπ„Å´„Å™„Çã„Åü„ÇÅ„ÄÅË®≠ÂÆö„ÇíÁ¢∫Ë™ç
      const artifactElement = document.querySelector(
        '[data-testid*="artifact"], .artifact, [class*="artifact"]',
      );
      if (artifactElement) {
        console.log("[11.autoai][Claude] ‚úÖ Artifacts„ÅØÊó¢„Å´Âà©Áî®ÂèØËÉΩ„Åß„Åô");
        return true;
      }

      // ArtifactsË®≠ÂÆö„Éú„Çø„É≥„ÇíÊé¢„Åô
      const settingsButton = document.querySelector(
        'button[aria-label*="settings"], button[aria-label*="Settings"]',
      );
      if (settingsButton) {
        settingsButton.click();
        await sleep(500);

        // ArtifactsË®≠ÂÆö„ÇíÊé¢„Åô
        const artifactToggle = Array.from(
          document.querySelectorAll('input[type="checkbox"], button'),
        ).find(
          (el) =>
            el.parentElement?.textContent?.includes("Artifacts") ||
            el.getAttribute("aria-label")?.includes("Artifacts"),
        );

        if (artifactToggle && !artifactToggle.checked) {
          artifactToggle.click();
          await sleep(500);
          console.log("[11.autoai][Claude] ‚úÖ Artifacts„ÅåÊúâÂäπ„Å´„Å™„Çä„Åæ„Åó„Åü");
          // Ë®≠ÂÆö„ÇíÈñâ„Åò„Çã
          document.body.click();
          return true;
        }
      }

      console.log("[11.autoai][Claude] ‚úÖ Artifacts„ÅØÊó¢„Å´ÊúâÂäπ„Åß„Åô");
      return true;
    } catch (error) {
      console.error("[11.autoai][Claude] ArtifactsÊúâÂäπÂåñ„Ç®„É©„Éº:", error);
      return false;
    }
  }

  async function disableClaudeArtifacts() {
    console.log("[11.autoai][Claude] üõ†Ô∏è Artifacts„É¢„Éº„Éâ„ÇíÁÑ°ÂäπÂåñ‰∏≠...");

    try {
      const settingsButton = document.querySelector(
        'button[aria-label*="settings"], button[aria-label*="Settings"]',
      );
      if (settingsButton) {
        settingsButton.click();
        await sleep(500);

        const artifactToggle = Array.from(
          document.querySelectorAll('input[type="checkbox"]'),
        ).find((el) => el.parentElement?.textContent?.includes("Artifacts"));

        if (artifactToggle && artifactToggle.checked) {
          artifactToggle.click();
          await sleep(500);
          console.log("[11.autoai][Claude] ‚úÖ Artifacts„ÇíÁÑ°ÂäπÂåñ„Åó„Åæ„Åó„Åü");
          document.body.click();
          return true;
        }
      }
      return false;
    } catch (error) {
      console.error("[11.autoai][Claude] ArtifactsÁÑ°ÂäπÂåñ„Ç®„É©„Éº:", error);
      return false;
    }
  }

  // ===== Claude „É¢„Éá„É´ÈÅ∏ÊäûÂà∂Âæ° =====

  async function enableClaudeModel(modelName) {
    console.log(`[11.autoai][Claude] üß† ${modelName}„É¢„Éá„É´„ÇíÊúâÂäπÂåñ‰∏≠...`);

    try {
      // „É¢„Éá„É´ÈÅ∏Êäû„Éú„Çø„É≥„ÇíÊé¢„Åô
      const modelButton = document.querySelector(
        'button[role="combobox"], button[aria-haspopup="true"], button[data-testid*="model"]',
      );
      if (!modelButton) {
        console.warn("[11.autoai][Claude] ‚ùå „É¢„Éá„É´ÈÅ∏Êäû„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");
        return false;
      }

      // „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÇíÈñã„Åè
      console.log("[11.autoai][Claude] „É¢„Éá„É´ÈÅ∏Êäû„É°„Éã„É•„Éº„ÇíÈñã„Åç„Åæ„Åô");
      modelButton.click();
      await sleep(500);

      // ÊåáÂÆö„Åï„Çå„Åü„É¢„Éá„É´„Ç™„Éó„Ç∑„Éß„É≥„ÇíÊé¢„Åô
      const modelOption = Array.from(
        document.querySelectorAll('[role="option"], [role="menuitem"]'),
      ).find((item) => item.textContent?.includes(modelName));

      if (modelOption) {
        console.log(`[11.autoai][Claude] üß† ${modelName}„É¢„Éá„É´„ÇíÈÅ∏Êäû`);
        modelOption.click();
        await sleep(500);
        console.log(
          `[11.autoai][Claude] ‚úÖ ${modelName}„É¢„Éá„É´„ÅåÊúâÂäπ„Å´„Å™„Çä„Åæ„Åó„Åü`,
        );
        return true;
      } else {
        console.warn(
          `[11.autoai][Claude] ‚ùå ${modelName}„É¢„Éá„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì`,
        );
        // „É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
        document.body.click();
        return false;
      }
    } catch (error) {
      console.error(`[11.autoai][Claude] ${modelName}ÊúâÂäπÂåñ„Ç®„É©„Éº:`, error);
      return false;
    }
  }

  // ===== ÂÄãÂà•„É¢„Éá„É´Âà∂Âæ°Èñ¢Êï∞ =====

  async function enableClaudeSonnet() {
    return await enableClaudeModel("Sonnet");
  }

  async function enableClaudeHaiku() {
    return await enableClaudeModel("Haiku");
  }

  async function enableClaudeOpus() {
    return await enableClaudeModel("Opus");
  }

  // ===== Claude DeepResearchÂà∂Âæ°ÔºàÊó¢Â≠òÊ©üËÉΩ„Å®„ÅÆÁµ±ÂêàÔºâ =====

  async function enableClaudeDeepResearch() {
    console.log("[11.autoai][Claude] üî¨ DeepResearchÊ©üËÉΩ„ÇíÊúâÂäπÂåñ‰∏≠...");

    try {
      // „Çπ„ÉÜ„ÉÉ„Éó1: „ÉÑ„Éº„É´„É°„Éã„É•„Éº„ÇíÈñã„Åè
      console.log("[11.autoai][Claude] üìã „Çπ„ÉÜ„ÉÉ„Éó1: „ÉÑ„Éº„É´„É°„Éã„É•„Éº„ÇíÈñã„Åè");
      const toolsButton = document.querySelector(
        'button[id="input-tools-menu-trigger"]',
      );
      if (!toolsButton) {
        console.error(
          "[11.autoai][Claude] ‚ùå „ÉÑ„Éº„É´„É°„Éã„É•„Éº„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì",
        );
        return false;
      }

      // „É°„Éã„É•„Éº„ÅåÈñâ„Åò„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÈñã„Åè
      if (toolsButton.getAttribute("aria-expanded") !== "true") {
        toolsButton.click();
        await sleep(800);
        console.log("[11.autoai][Claude] ‚úÖ „ÉÑ„Éº„É´„É°„Éã„É•„Éº„ÇíÈñã„Åç„Åæ„Åó„Åü");
      } else {
        console.log("[11.autoai][Claude] ‚ÑπÔ∏è „ÉÑ„Éº„É´„É°„Éã„É•„Éº„ÅØÊó¢„Å´Èñã„ÅÑ„Å¶„ÅÑ„Åæ„Åô");
      }

      // „Çπ„ÉÜ„ÉÉ„Éó2: WebÊ§úÁ¥¢„É¢„Éº„Éâ„ÇíÊúâÂäπÂåñ
      console.log("[11.autoai][Claude] üîç „Çπ„ÉÜ„ÉÉ„Éó2: WebÊ§úÁ¥¢„ÇíÊúâÂäπÂåñ");
      const webSearchButton = Array.from(
        document.querySelectorAll("button"),
      ).find((btn) => btn.textContent?.includes("„Ç¶„Çß„ÉñÊ§úÁ¥¢"));

      if (!webSearchButton) {
        console.error(
          "[11.autoai][Claude] ‚ùå „Ç¶„Çß„ÉñÊ§úÁ¥¢„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì",
        );
        // „Éá„Éê„ÉÉ„Ç∞: „Éú„Çø„É≥‰∏ÄË¶ßË°®Á§∫
        console.log("[11.autoai][Claude] Âà©Áî®ÂèØËÉΩ„Å™„Éú„Çø„É≥:");
        document.querySelectorAll("button").forEach((btn, i) => {
          const text = btn.textContent?.trim();
          if (text && text.length < 30) {
            console.log(`  ${i}: "${text}"`);
          }
        });
        return false;
      }

      if (!webSearchButton.classList.contains("text-primary-500")) {
        webSearchButton.click();
        await sleep(500);
        console.log("[11.autoai][Claude] ‚úÖ WebÊ§úÁ¥¢„ÇíÊúâÂäπÂåñ„Åó„Åæ„Åó„Åü");
      } else {
        console.log("[11.autoai][Claude] ‚ÑπÔ∏è WebÊ§úÁ¥¢„ÅØÊó¢„Å´ÊúâÂäπ„Åß„Åô");
      }

      // „Çπ„ÉÜ„ÉÉ„Éó3: „É™„Çµ„Éº„ÉÅ„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ
      console.log("[11.autoai][Claude] üî¨ „Çπ„ÉÜ„ÉÉ„Éó3: „É™„Çµ„Éº„ÉÅ„Éú„Çø„É≥„ÇíÊäº„Åô");
      await sleep(500); // „Éú„Çø„É≥Ë™≠„ÅøËæº„ÅøÂæÖÊ©ü

      const researchButton = Array.from(
        document.querySelectorAll("button"),
      ).find((btn) => {
        const svg = btn.querySelector('svg path[d*="M8.5 2C12.0899"]');
        const text = btn.querySelector("p");
        return svg && text && text.textContent === "„É™„Çµ„Éº„ÉÅ";
      });

      if (!researchButton) {
        console.error("[11.autoai][Claude] ‚ùå „É™„Çµ„Éº„ÉÅ„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");
        return false;
      }

      const isPressed = researchButton.getAttribute("aria-pressed") === "true";
      if (!isPressed) {
        researchButton.click();
        await sleep(500);
        console.log("[11.autoai][Claude] ‚úÖ „É™„Çµ„Éº„ÉÅ„É¢„Éº„Éâ„ÇíÊúâÂäπÂåñ„Åó„Åæ„Åó„Åü");
      } else {
        console.log("[11.autoai][Claude] ‚ÑπÔ∏è „É™„Çµ„Éº„ÉÅ„É¢„Éº„Éâ„ÅØÊó¢„Å´ÊúâÂäπ„Åß„Åô");
      }

      console.log(
        "[11.autoai][Claude] ‚úÖ DeepResearch„É¢„Éº„Éâ„ÅåÂÆåÂÖ®„Å´ÊúâÂäπ„Å´„Å™„Çä„Åæ„Åó„Åü",
      );
      return true;
    } catch (error) {
      console.error("[11.autoai][Claude] ‚ùå DeepResearchÊúâÂäπÂåñ„Ç®„É©„Éº:", error);
      return false;
    }
  }

  async function disableClaudeDeepResearch() {
    console.log("[11.autoai][Claude] üî¨ DeepResearchÊ©üËÉΩ„ÇíÁÑ°ÂäπÂåñ‰∏≠...");

    try {
      // „Åæ„Åö„ÄÅ„É™„Çµ„Éº„ÉÅ„Éú„Çø„É≥ÔºàÁ†îÁ©∂„Ç¢„Ç§„Ç≥„É≥Ôºâ„ÇíÊé¢„Åô
      const buttons = document.querySelectorAll('button[type="button"]');
      let targetButton = null;

      for (const btn of buttons) {
        const svg = btn.querySelector('svg path[d*="M8.5 2C12.0899"]');
        const text = btn.querySelector("p");
        if (svg && text && text.textContent === "„É™„Çµ„Éº„ÉÅ") {
          targetButton = btn;
          break;
        }
      }

      if (targetButton) {
        const isPressed = targetButton.getAttribute("aria-pressed") === "true";

        if (isPressed) {
          console.log(
            "[11.autoai][Claude] üîç „É™„Çµ„Éº„ÉÅ„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÁÑ°ÂäπÂåñ„Åó„Åæ„Åô",
          );
          targetButton.click();
          await sleep(500);
          console.log(
            "[11.autoai][Claude] ‚úÖ „É™„Çµ„Éº„ÉÅ„É¢„Éº„Éâ„ÅåÁÑ°Âäπ„Å´„Å™„Çä„Åæ„Åó„Åü",
          );
        } else {
          console.log("[11.autoai][Claude] ‚ÑπÔ∏è „É™„Çµ„Éº„ÉÅ„É¢„Éº„Éâ„ÅØÊó¢„Å´ÁÑ°Âäπ„Åß„Åô");
        }
        return true;
      }

      // „É™„Çµ„Éº„ÉÅ„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅÊó¢Â≠ò„ÅÆÂÆüË£Ö„ÇíË©¶„Åô
      console.log(
        "[11.autoai][Claude] „É™„Çµ„Éº„ÉÅ„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑ„Åü„ÇÅ„ÄÅÊó¢Â≠ò„ÅÆÂÆüË£Ö„ÇíË©¶„Åó„Åæ„Åô",
      );

      if (window.disableDeepResearch) {
        return await window.disableDeepResearch();
      }

      return false;
    } catch (error) {
      console.error("[11.autoai][Claude] ‚ùå DeepResearchÁÑ°ÂäπÂåñ„Ç®„É©„Éº:", error);
      return false;
    }
  }

  // ===== Áµ±ÂêàÂà∂Âæ°Èñ¢Êï∞ =====

  /**
   * ÂÖ®„Å¶„ÅÆÁâπÊÆäÊ©üËÉΩ„ÇíÁÑ°ÂäπÂåñ
   */
  async function disableAllClaudeModes() {
    console.log("[11.autoai][Claude] üîÑ ÂÖ®„É¢„Éº„Éâ„ÇíÁÑ°ÂäπÂåñ‰∏≠...");

    const results = await Promise.allSettled([
      disableClaudeProjects(),
      disableClaudeArtifacts(),
      disableClaudeDeepResearch(),
    ]);

    console.log("[11.autoai][Claude] ‚úÖ ÂÖ®„É¢„Éº„ÉâÁÑ°ÂäπÂåñÂÆå‰∫Ü");
    return results.some(
      (result) => result.status === "fulfilled" && result.value,
    );
  }

  /**
   * ÊåáÂÆö„Åï„Çå„Åü„É¢„Éº„Éâ„ÇíÊúâÂäπÂåñ
   */
  async function enableClaudeMode(mode) {
    console.log(`[11.autoai][Claude] üîÑ ${mode}„É¢„Éº„Éâ„ÇíÊúâÂäπÂåñ‰∏≠...`);

    // „Åæ„ÅöÁâπÊÆäÊ©üËÉΩ„ÇíÁÑ°ÂäπÂåñÔºà„É¢„Éá„É´Â§âÊõ¥„ÅØÈô§„ÅèÔºâ
    await Promise.allSettled([
      disableClaudeProjects(),
      disableClaudeDeepResearch(),
    ]);
    await sleep(500);

    switch (mode) {
      case "Projects":
        return await enableClaudeProjects();
      case "Artifacts":
        return await enableClaudeArtifacts();
      case "Sonnet":
        return await enableClaudeSonnet();
      case "Haiku":
        return await enableClaudeHaiku();
      case "Opus":
        return await enableClaudeOpus();
      case "DeepResearch":
        return await enableClaudeDeepResearch();
      default:
        console.log(`[11.autoai][Claude] ‚úÖ Ê®ôÊ∫ñ„É¢„Éº„Éâ„Å´Ë®≠ÂÆö`);
        return true;
    }
  }

  // ===== „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„Å®„Åó„Å¶ÂÖ¨Èñã =====

  window.enableClaudeProjects = enableClaudeProjects;
  window.disableClaudeProjects = disableClaudeProjects;
  window.enableClaudeArtifacts = enableClaudeArtifacts;
  window.disableClaudeArtifacts = disableClaudeArtifacts;
  window.enableClaudeSonnet = enableClaudeSonnet;
  window.enableClaudeHaiku = enableClaudeHaiku;
  window.enableClaudeOpus = enableClaudeOpus;
  window.enableClaudeModel = enableClaudeModel;
  window.enableClaudeDeepResearch = enableClaudeDeepResearch;
  window.disableClaudeDeepResearch = disableClaudeDeepResearch;
  window.disableAllClaudeModes = disableAllClaudeModes;
  window.enableClaudeMode = enableClaudeMode;

  console.log("[11.autoai][Claude] ‚úÖ „É¢„Éº„ÉâÂà∂Âæ°Ê©üËÉΩ„ÅåÂà©Áî®ÂèØËÉΩ„Å´„Å™„Çä„Åæ„Åó„Åü");
  console.log("[11.autoai][Claude] Âà©Áî®ÂèØËÉΩ„Å™Èñ¢Êï∞:");
  console.log("  - enableClaudeProjects()");
  console.log("  - enableClaudeArtifacts()");
  console.log("  - enableClaudeSonnet()");
  console.log("  - enableClaudeHaiku()");
  console.log("  - enableClaudeOpus()");
  console.log("  - enableClaudeDeepResearch()");
  console.log(
    "  - enableClaudeMode('Projects'|'Artifacts'|'Sonnet'|'Haiku'|'Opus'|'DeepResearch')",
  );
  console.log("  - disableAllClaudeModes()");
})();
