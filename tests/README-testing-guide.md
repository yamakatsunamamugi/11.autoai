# 🧪 11.autoai テスト実行ガイド

## 概要
11.autoaiのコンテンツスクリプト機能をテストするための詳細ガイドです。

## 📁 テストファイル構成

```
11.autoai/tests/
├── test-ai-model-behavior.html          # AIモデル別動作テスト（モック環境）
├── test-real-ai-integration.html        # 実際のAI統合テスト（実環境）
├── test-content-script-integration.html # コンテンツスクリプト統合テスト
├── test-content-script-functions.html   # コンテンツスクリプト機能単体テスト
└── README-testing-guide.md              # このファイル
```

## 🚀 テスト実行手順

### Step 1: Chrome拡張機能の準備

1. **Chromeを開き、拡張機能管理画面にアクセス**
   ```
   chrome://extensions/
   ```

2. **デベロッパーモードを有効化**
   - 右上の「デベロッパーモード」トグルをON

3. **11.autoaiを読み込み**
   - 「パッケージ化されていない拡張機能を読み込む」をクリック
   - `11.autoai` フォルダを選択
   - 拡張機能が正常に読み込まれることを確認

### Step 2: 基本動作確認テスト

#### A. モック環境テスト（初心者向け）

1. **ファイルを開く**
   ```bash
   # macOS/Linux
   open 11.autoai/tests/test-ai-model-behavior.html
   
   # Windows
   start 11.autoai/tests/test-ai-model-behavior.html
   ```

2. **テスト実行**
   - 各AIカード（ChatGPT、Claude、Gemini）の「基本テスト」ボタンをクリック
   - 比較表で結果を確認
   - ログでエラー詳細を確認

3. **期待される結果**
   ```
   ✅ セレクタ検出: 80-90%成功
   ✅ プロンプト入力: 85%以上成功
   ✅ 送信ボタン: 90%以上成功
   ✅ 応答収集: 80%以上成功
   ```

#### B. 機能単体テスト

1. **ファイルを開く**
   ```bash
   open 11.autoai/tests/test-content-script-functions.html
   ```

2. **個別機能テスト**
   - SelectorFactory テスト
   - DOM Utility Functions テスト
   - Input Handler テスト
   - Response Collector テスト

### Step 3: 実環境統合テスト（上級者向け）

#### A. 実際のAIサイトテスト

1. **テストファイルを開く**
   ```bash
   open 11.autoai/tests/test-real-ai-integration.html
   ```

2. **AIウィンドウを開く**
   ```
   1. ChatGPT → 「ウィンドウ開放」ボタンをクリック
   2. 新しいウィンドウでhttps://chatgpt.com/が開くことを確認
   3. Claude → 「ウィンドウ開放」ボタンをクリック
   4. 新しいウィンドウでhttps://claude.ai/newが開くことを確認
   5. Gemini → 「ウィンドウ開放」ボタンをクリック
   6. 新しいウィンドウでhttps://gemini.google.com/appが開くことを確認
   ```

3. **コンテンツスクリプト接続確認**
   ```
   1. 各AIウィンドウが開いた後、3秒待機
   2. 各AIの「接続テスト」ボタンをクリック
   3. 状態表示が「準備完了」になることを確認
   ```

4. **実際のAI操作テスト**
   ```
   1. テストプロンプト欄に簡単な質問を入力
      例: "こんにちは！あなたの名前を教えてください。"
   2. 「フル統合テスト」ボタンをクリック
   3. 実際にAIサイトでプロンプトが送信されることを確認
   4. 応答が取得されることを確認
   ```

#### B. 並列処理テスト

1. **並列モード設定**
   - テストモード: 「並列実行」を選択
   - タイムアウト: 60秒に設定

2. **実行**
   - 「フル統合テスト」ボタンをクリック
   - 3つのAIウィンドウで同時にプロンプト処理が実行されることを確認

### Step 4: エラー・障害テスト

#### A. エラーシナリオテスト

1. **意図的エラーテスト**
   ```
   1. 「エラーシナリオテスト」ボタンをクリック
   2. 以下のエラーが適切に処理されることを確認:
      - 存在しないタブへのメッセージ送信
      - 無効なアクション送信
      - タイムアウト発生
      - 不正なプロンプト送信
   ```

2. **期待される結果**
   ```
   ✅ 各エラーが適切に検出される
   ✅ エラー後も他の機能が正常動作
   ✅ エラーログが詳細に記録される
   ```

#### B. セレクタフォールバックテスト

1. **フォールバック機能確認**
   ```
   1. 「セレクタフォールバックテスト」ボタンをクリック
   2. 複数のセレクタが順番に試行されることを確認
   3. 1つ失敗しても次のセレクタで復旧することを確認
   ```

### Step 5: パフォーマンステスト

#### A. 応答速度測定

1. **パフォーマンステスト実行**
   ```
   1. 「パフォーマンステスト開始」ボタンをクリック
   2. 各AIの応答時間を測定
   3. 最速・最遅AIを特定
   ```

2. **期待される結果**
   ```
   ChatGPT: 1500ms前後
   Claude: 2000ms前後  
   Gemini: 1200ms前後
   ```

#### B. 並列処理効率

1. **並列処理テスト**
   ```
   1. 「並列処理テスト」ボタンをクリック
   2. 6個の並列タスクが実行される
   3. 平均処理時間と成功率を確認
   ```

## 🔍 トラブルシューティング

### よくある問題と解決方法

#### 1. 拡張機能が読み込まれない
```
問題: 「パッケージ化されていない拡張機能を読み込む」でエラー
解決: 
- manifest.jsonの構文エラーをチェック
- 必要なファイルが存在するかチェック
- Chromeの開発者ツールでエラーログを確認
```

#### 2. コンテンツスクリプトが動作しない
```
問題: 「接続テスト」で応答がない
解決:
- AIサイトのページが完全に読み込まれるまで待機
- Chrome開発者ツールのConsoleタブでエラーチェック
- manifest.jsonのcontent_scripts設定を確認
```

#### 3. セレクタが見つからない
```
問題: 「セレクタ検出」テストで失敗
解決:
- AIサイトのDOM構造が変更されている可能性
- セレクタ情報出力でセレクタを確認
- ブラウザの開発者ツールで要素を検査
```

#### 4. プロンプト送信が失敗する
```
問題: プロンプトが入力されない
解決:
- AIサイトのログイン状態を確認
- セレクタが正しく入力フィールドを特定しているか確認
- イベント発火（input, change）が適切に実行されているか確認
```

#### 5. 応答収集がタイムアウトする
```
問題: AI応答の取得ができない
解決:
- タイムアウト時間を延長（60-180秒）
- 応答完了判定ロジックを確認
- MutationObserverが適切に動作しているか確認
```

## 📊 テスト結果の評価基準

### 成功基準

#### 基本機能
- **セレクタ検出**: 80%以上の成功率
- **プロンプト入力**: 85%以上の成功率
- **送信実行**: 90%以上の成功率
- **応答収集**: 75%以上の成功率

#### パフォーマンス
- **応答速度**: 5秒以内（通常時）
- **並列処理**: 6並列で80%以上成功
- **メモリ使用量**: 50MB以下

#### 安定性
- **エラー回復**: 90%以上の回復率
- **長時間動作**: 10分間連続動作
- **フォールバック**: セレクタ変更に対応

## 🚀 高度なテスト

### カスタムテスト作成

1. **独自のテストシナリオ作成**
   ```javascript
   // test-custom.html として新規作成
   async function customTest() {
       // カスタムロジック
       const result = await testCustomScenario();
       return result;
   }
   ```

2. **特定AIモデルのテスト**
   ```javascript
   // 特定モデル（例: GPT-4o, o1-preview）のテスト
   async function testSpecificModel(modelName) {
       // モデル固有のテスト実装
   }
   ```

### 大規模テスト

1. **ストレステスト**
   ```
   - 100並列タスクの実行
   - 24時間連続動作テスト
   - 大量データ処理テスト
   ```

2. **統合システムテスト**
   ```
   - StreamProcessor + コンテンツスクリプトの完全統合
   - Google Sheets連携テスト
   - エラー耐性テスト
   ```

## 📋 レポート生成

### テスト結果のエクスポート

1. **JSON形式でエクスポート**
   ```
   1. 「テスト結果エクスポート」ボタンをクリック
   2. ai-integration-test-results-[timestamp].json がダウンロード
   3. 結果を分析・共有
   ```

2. **結果分析**
   ```json
   {
     "timestamp": "2024-01-01T12:00:00.000Z",
     "extensionMode": true,
     "openWindows": [...],
     "testResults": [...],
     "logs": {...}
   }
   ```

## 🔧 開発者向け情報

### デバッグ機能

1. **セレクタ情報ダンプ**
   ```
   - 現在のセレクタ設定を出力
   - DOM要素の検出状況を確認
   - フォールバック順序を確認
   ```

2. **リアルタイム監視**
   ```
   - コンテンツスクリプトの状態監視
   - タブレジストリの状況確認
   - メモリ使用量の監視
   ```

3. **ログレベル設定**
   ```javascript
   // デバッグモード有効化
   window.toggleDebugMode();
   
   // ログレベル変更
   window.updateConfig({ CURRENT_LOG_LEVEL: 3 });
   ```

これで11.autoaiのコンテンツスクリプト機能を包括的にテストできます！