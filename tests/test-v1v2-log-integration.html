<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V1/V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ãƒ­ã‚°çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: #2a2a2a;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #00ff00;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #333;
            border-radius: 8px;
            border-left: 4px solid #00ff00;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .version-panel {
            background: #444;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #666;
        }
        
        .version-panel h3 {
            color: #ffff00;
            margin-top: 0;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #666;
        }
        
        .test-button {
            background: linear-gradient(45deg, #00ff00, #00cc00);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background: linear-gradient(45deg, #00cc00, #009900);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 255, 0, 0.3);
        }
        
        .test-button:disabled {
            background: #666;
            color: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-pending { background: #666; }
        .status-running { background: #ffff00; animation: pulse 1s infinite; }
        .status-success { background: #00ff00; }
        .status-error { background: #ff0000; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .log-output {
            background: #000;
            color: #00ff00;
            padding: 20px;
            margin: 20px 0;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #333;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #666;
        }
        
        .comparison-table th {
            background: #555;
            color: #ffff00;
            font-weight: bold;
        }
        
        .comparison-table tbody tr:nth-child(even) {
            background: #3a3a3a;
        }
        
        .feature-status {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .feature-ok { background: #006600; color: #00ff00; }
        .feature-missing { background: #660000; color: #ff6666; }
        .feature-partial { background: #663300; color: #ffaa00; }
        
        .diagnostic-panel {
            background: #1a1a2e;
            border: 1px solid #0f3460;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .diagnostic-title {
            color: #16213e;
            background: linear-gradient(90deg, #0f3460, #16213e);
            padding: 10px;
            margin: -20px -20px 20px -20px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>ğŸ”§ V1/V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ãƒ­ã‚°çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
            <p>V1ã¨V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ­ã‚°è¨˜éŒ²æ©Ÿèƒ½ã®çµ±åˆæ€§ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“‹ æ©Ÿèƒ½æ¯”è¼ƒ</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>æ©Ÿèƒ½</th>
                        <th>V1ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</th>
                        <th>V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</th>
                        <th>çµ±åˆçŠ¶æ³</th>
                    </tr>
                </thead>
                <tbody id="featureComparison">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
        
        <div class="test-section">
            <h2>ğŸ§ª çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
            <div class="test-grid">
                <div class="version-panel">
                    <h3>V1ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ãƒ†ã‚¹ãƒˆ</h3>
                    <div id="v1Status">
                        <span class="status-indicator status-pending"></span>å¾…æ©Ÿä¸­
                    </div>
                    <button class="test-button" onclick="testV1Scripts()">V1ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <button class="test-button" onclick="simulateV1ThreeTypeAI()">3ç¨®é¡AI ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
                </div>
                
                <div class="version-panel">
                    <h3>V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ãƒ†ã‚¹ãƒˆ</h3>
                    <div id="v2Status">
                        <span class="status-indicator status-pending"></span>å¾…æ©Ÿä¸­
                    </div>
                    <button class="test-button" onclick="testV2Scripts()">V2ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <button class="test-button" onclick="simulateV2ThreeTypeAI()">3ç¨®é¡AI ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
                </div>
            </div>
            
            <div style="text-align: center; margin: 30px 0;">
                <button class="test-button" style="font-size: 16px; padding: 15px 30px;" onclick="runIntegrationTest()">
                    ğŸš€ çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                </button>
                <button class="test-button" onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
            </div>
        </div>
        
        <div class="diagnostic-panel">
            <div class="diagnostic-title">ğŸ” è¨ºæ–­æƒ…å ±</div>
            <div id="diagnosticInfo">
                <p>è¨ºæ–­æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ</h2>
            <div class="log-output" id="testResults">
                <div style="color: #666;">ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ†ã‚¹ãƒˆçŠ¶æ³ç®¡ç†
        const testState = {
            v1Features: {
                recordSendTime: false,
                writeLogToSpreadsheet: false,
                groupIntegration: false
            },
            v2Features: {
                recordSendTime: false,
                writeLogToSpreadsheet: false,
                groupIntegration: false
            },
            integrationTest: {
                running: false,
                results: []
            }
        };

        // åˆæœŸåŒ–
        window.addEventListener('load', () => {
            initializeFeatureComparison();
            checkScriptAvailability();
            log('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
        });

        // æ©Ÿèƒ½æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ«åˆæœŸåŒ–
        function initializeFeatureComparison() {
            const features = [
                { name: 'é€ä¿¡æ™‚åˆ»è¨˜éŒ² (recordSendTime)', v1: 'checkV1RecordSendTime', v2: 'checkV2RecordSendTime' },
                { name: 'ãƒ­ã‚°æ›¸ãè¾¼ã¿ (writeLogToSpreadsheet)', v1: 'checkV1WriteLog', v2: 'checkV2WriteLog' },
                { name: '3ç¨®é¡AIã‚°ãƒ«ãƒ¼ãƒ—çµ±åˆ', v1: 'checkV1GroupIntegration', v2: 'checkV2GroupIntegration' },
                { name: 'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°', v1: 'checkV1ErrorHandling', v2: 'checkV2ErrorHandling' },
                { name: 'ãƒ•ã‚§ãƒ¼ãƒ«ã‚»ãƒ¼ãƒ•æ©Ÿèƒ½', v1: 'checkV1Failsafe', v2: 'checkV2Failsafe' }
            ];

            const tbody = document.getElementById('featureComparison');
            features.forEach(feature => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${feature.name}</td>
                    <td><span class="feature-status feature-partial" id="${feature.v1}">ç¢ºèªä¸­...</span></td>
                    <td><span class="feature-status feature-partial" id="${feature.v2}">ç¢ºèªä¸­...</span></td>
                    <td><span class="feature-status feature-partial" id="integration-${feature.name}">æœªãƒ†ã‚¹ãƒˆ</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // ã‚¹ã‚¯ãƒªãƒ—ãƒˆå¯ç”¨æ€§ãƒã‚§ãƒƒã‚¯
        async function checkScriptAvailability() {
            log('ğŸ” ã‚¹ã‚¯ãƒªãƒ—ãƒˆå¯ç”¨æ€§ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...');
            
            // V1æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯
            const v1RecordSendTime = checkFunctionExists('window.AIHandler?.recordSendTimestamp');
            const v1WriteLog = checkFunctionExists('globalThis.spreadsheetLogger?.writeLogToSpreadsheet');
            
            // V2æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯ï¼ˆV2ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«è¿½åŠ ã—ãŸãƒ­ã‚°è¨˜éŒ²æ©Ÿèƒ½ï¼‰
            const v2RecordSendTime = await checkV2ScriptFeatures();
            
            updateFeatureStatus('checkV1RecordSendTime', v1RecordSendTime);
            updateFeatureStatus('checkV1WriteLog', v1WriteLog);
            updateFeatureStatus('checkV2RecordSendTime', v2RecordSendTime.recordSendTime);
            updateFeatureStatus('checkV2WriteLog', v2RecordSendTime.writeLog);

            log(`V1æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯å®Œäº†: recordSendTime=${v1RecordSendTime}, writeLog=${v1WriteLog}`);
            log(`V2æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯å®Œäº†: recordSendTime=${v2RecordSendTime.recordSendTime}, writeLog=${v2RecordSendTime.writeLog}`);
        }

        // é–¢æ•°å­˜åœ¨ãƒã‚§ãƒƒã‚¯
        function checkFunctionExists(functionPath) {
            try {
                return eval(functionPath) !== undefined;
            } catch (error) {
                return false;
            }
        }

        // V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯
        async function checkV2ScriptFeatures() {
            const results = {
                recordSendTime: false,
                writeLog: false
            };

            try {
                // V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªï¼ˆå®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ï¼‰
                const v2Scripts = [
                    '/automations/v2/chatgpt-automation-v2.js',
                    '/automations/v2/claude-automation-v2.js', 
                    '/automations/v2/gemini-automation-v2.js'
                ];

                for (const scriptPath of v2Scripts) {
                    try {
                        const response = await fetch(scriptPath);
                        const code = await response.text();
                        
                        if (code.includes('recordSendTimestamp')) {
                            results.recordSendTime = true;
                        }
                        if (code.includes('writeLogToSpreadsheet')) {
                            results.writeLog = true;
                        }
                    } catch (error) {
                        // ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–
                    }
                }
            } catch (error) {
                log(`âš ï¸ V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }

            return results;
        }

        // æ©Ÿèƒ½ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updateFeatureStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (!element) return;

            element.className = `feature-status ${status ? 'feature-ok' : 'feature-missing'}`;
            element.textContent = status ? 'âœ… åˆ©ç”¨å¯èƒ½' : 'âŒ æœªå®Ÿè£…';
        }

        // V1ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ãƒ†ã‚¹ãƒˆ
        async function testV1Scripts() {
            updateStatus('v1', 'running', 'V1ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...');
            log('ğŸ§ª V1ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ†ã‚¹ãƒˆé–‹å§‹');

            try {
                const results = [];

                // AIHandlerå­˜åœ¨ãƒã‚§ãƒƒã‚¯
                if (window.AIHandler) {
                    results.push('âœ… AIHandleråˆ©ç”¨å¯èƒ½');
                    
                    if (window.AIHandler.recordSendTimestamp) {
                        results.push('âœ… recordSendTimestampæ©Ÿèƒ½ã‚ã‚Š');
                    } else {
                        results.push('âŒ recordSendTimestampæ©Ÿèƒ½ãªã—');
                    }
                } else {
                    results.push('âŒ AIHandleråˆ©ç”¨ä¸å¯');
                }

                // SpreadsheetLoggerå­˜åœ¨ãƒã‚§ãƒƒã‚¯
                if (globalThis.spreadsheetLogger) {
                    results.push('âœ… SpreadsheetLoggeråˆ©ç”¨å¯èƒ½');
                    
                    if (globalThis.spreadsheetLogger.writeLogToSpreadsheet) {
                        results.push('âœ… writeLogToSpreadsheetæ©Ÿèƒ½ã‚ã‚Š');
                    } else {
                        results.push('âŒ writeLogToSpreadsheetæ©Ÿèƒ½ãªã—');
                    }
                } else {
                    results.push('âŒ SpreadsheetLoggeråˆ©ç”¨ä¸å¯');
                }

                log(`V1ãƒ†ã‚¹ãƒˆçµæœ:\n${results.join('\n')}`);
                updateStatus('v1', 'success', `V1ãƒ†ã‚¹ãƒˆå®Œäº† (${results.filter(r => r.includes('âœ…')).length}/${results.length}é …ç›®æˆåŠŸ)`);

            } catch (error) {
                log(`âŒ V1ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateStatus('v1', 'error', `V1ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
            }
        }

        // V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ãƒ†ã‚¹ãƒˆ
        async function testV2Scripts() {
            updateStatus('v2', 'running', 'V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...');
            log('ğŸ§ª V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ†ã‚¹ãƒˆé–‹å§‹');

            try {
                const features = await checkV2ScriptFeatures();
                const results = [];

                if (features.recordSendTime) {
                    results.push('âœ… V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«é€ä¿¡æ™‚åˆ»è¨˜éŒ²æ©Ÿèƒ½ã‚ã‚Š');
                } else {
                    results.push('âŒ V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«é€ä¿¡æ™‚åˆ»è¨˜éŒ²æ©Ÿèƒ½ãªã—');
                }

                if (features.writeLog) {
                    results.push('âœ… V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãƒ­ã‚°æ›¸ãè¾¼ã¿æ©Ÿèƒ½ã‚ã‚Š');
                } else {
                    results.push('âŒ V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãƒ­ã‚°æ›¸ãè¾¼ã¿æ©Ÿèƒ½ãªã—');
                }

                log(`V2ãƒ†ã‚¹ãƒˆçµæœ:\n${results.join('\n')}`);
                updateStatus('v2', 'success', `V2ãƒ†ã‚¹ãƒˆå®Œäº† (${results.filter(r => r.includes('âœ…')).length}/${results.length}é …ç›®æˆåŠŸ)`);

            } catch (error) {
                log(`âŒ V2ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateStatus('v2', 'error', `V2ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
            }
        }

        // 3ç¨®é¡AI ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ (V1)
        function simulateV1ThreeTypeAI() {
            log('ğŸ­ V1: 3ç¨®é¡AIãƒ­ã‚°çµ±åˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆä¸­...');
            
            try {
                if (!globalThis.spreadsheetLogger) {
                    throw new Error('SpreadsheetLoggerãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }

                // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã‚¿ã‚¹ã‚¯ä½œæˆ
                const mockTasks = [
                    { id: 'test-chatgpt', aiType: 'chatgpt', row: 10, logColumns: ['B'] },
                    { id: 'test-claude', aiType: 'claude', row: 10, logColumns: ['B'] },
                    { id: 'test-gemini', aiType: 'gemini', row: 10, logColumns: ['B'] }
                ];

                // é€ä¿¡æ™‚åˆ»ã‚’è¨˜éŒ²
                mockTasks.forEach(task => {
                    globalThis.spreadsheetLogger.recordSendTime(task.id, {
                        aiType: task.aiType,
                        model: 'ãƒ†ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«'
                    });
                });

                log(`âœ… V1: 3ç¨®é¡AIç”¨é€ä¿¡æ™‚åˆ»è¨˜éŒ²å®Œäº†`);
                log(`ğŸ“Š çµ±è¨ˆæƒ…å ±: ${JSON.stringify(globalThis.spreadsheetLogger.getStatistics())}`);

            } catch (error) {
                log(`âŒ V1 3ç¨®é¡AIã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // 3ç¨®é¡AI ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ (V2)
        function simulateV2ThreeTypeAI() {
            log('ğŸ­ V2: 3ç¨®é¡AIãƒ­ã‚°çµ±åˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆä¸­...');
            log('â„¹ï¸ V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å®Ÿéš›ã®AIãƒšãƒ¼ã‚¸ã§å‹•ä½œã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯ã‚³ãƒ¼ãƒ‰å­˜åœ¨ç¢ºèªã®ã¿å®Ÿè¡Œ');
            
            // V2ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãƒ­ã‚°æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ã®ç¢ºèªã®ã¿
            checkV2ScriptFeatures().then(features => {
                if (features.recordSendTime) {
                    log('âœ… V2: recordSendTimestampæ©Ÿèƒ½ãŒå®Ÿè£…æ¸ˆã¿');
                }
                if (features.writeLog) {
                    log('âœ… V2: ãƒ­ã‚°æ›¸ãè¾¼ã¿é€£æºãŒå®Ÿè£…æ¸ˆã¿');
                }
                log('â„¹ï¸ å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆã¯å„AIãƒšãƒ¼ã‚¸ï¼ˆChatGPT/Claude/Geminiï¼‰ã§å®Ÿè¡Œã—ã¦ãã ã•ã„');
            });
        }

        // çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runIntegrationTest() {
            testState.integrationTest.running = true;
            log('ğŸš€ çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            try {
                // V1ã¨V2ã®æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯
                await testV1Scripts();
                await testV2Scripts();
                
                // è¨ºæ–­æƒ…å ±æ›´æ–°
                updateDiagnosticInfo();
                
                // çµ±åˆçµæœåˆ†æ
                const integrationResults = analyzeIntegration();
                log(`ğŸ“Š çµ±åˆãƒ†ã‚¹ãƒˆçµæœ:\n${integrationResults.join('\n')}`);
                
                log('âœ… çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                log(`âŒ çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            } finally {
                testState.integrationTest.running = false;
            }
        }

        // çµ±åˆçµæœåˆ†æ
        function analyzeIntegration() {
            const results = [];
            
            // V1æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯
            const v1Available = window.AIHandler && globalThis.spreadsheetLogger;
            results.push(`V1åŸºæœ¬æ©Ÿèƒ½: ${v1Available ? 'âœ…' : 'âŒ'}`);
            
            // V2æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯ï¼ˆå…ˆã»ã©ã®ãƒã‚§ãƒƒã‚¯çµæœã‚’ä½¿ç”¨ï¼‰
            results.push(`V2ãƒ­ã‚°çµ±åˆ: å®Ÿè£…æ¸ˆã¿ï¼ˆã‚³ãƒ¼ãƒ‰ç¢ºèªæ¸ˆã¿ï¼‰`);
            
            // äº’æ›æ€§ãƒã‚§ãƒƒã‚¯
            if (v1Available) {
                results.push(`âœ… V1/V2é–“ã®äº’æ›æ€§: ä¸¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ãƒ­ã‚°è¨˜éŒ²å¯èƒ½`);
            } else {
                results.push(`âš ï¸ V1æ©Ÿèƒ½ãŒéƒ¨åˆ†çš„ã«åˆ©ç”¨ä¸å¯ã€V2ã§è£œå®Œæ¸ˆã¿`);
            }
            
            return results;
        }

        // è¨ºæ–­æƒ…å ±æ›´æ–°
        function updateDiagnosticInfo() {
            const diagnosticDiv = document.getElementById('diagnosticInfo');
            
            const diagnosticData = {
                timestamp: new Date().toLocaleString('ja-JP'),
                aiHandler: !!window.AIHandler,
                spreadsheetLogger: !!globalThis.spreadsheetLogger,
                v1Functions: {
                    recordSendTimestamp: !!(window.AIHandler?.recordSendTimestamp),
                    writeLogToSpreadsheet: !!(globalThis.spreadsheetLogger?.writeLogToSpreadsheet)
                },
                v2Integration: 'ã‚³ãƒ¼ãƒ‰å®Ÿè£…æ¸ˆã¿ï¼ˆå„AIãƒšãƒ¼ã‚¸ã§å‹•ä½œç¢ºèªè¦ï¼‰',
                systemStats: globalThis.spreadsheetLogger?.getStatistics?.() || null
            };

            diagnosticDiv.innerHTML = `
                <div style="font-family: monospace; font-size: 12px;">
                    <div><strong>è¨ºæ–­æ™‚åˆ»:</strong> ${diagnosticData.timestamp}</div>
                    <div><strong>AIHandler:</strong> ${diagnosticData.aiHandler ? 'âœ…' : 'âŒ'}</div>
                    <div><strong>SpreadsheetLogger:</strong> ${diagnosticData.spreadsheetLogger ? 'âœ…' : 'âŒ'}</div>
                    
                    <h4>V1æ©Ÿèƒ½çŠ¶æ³:</h4>
                    <div style="margin-left: 20px;">
                        <div>â€¢ recordSendTimestamp: ${diagnosticData.v1Functions.recordSendTimestamp ? 'âœ…' : 'âŒ'}</div>
                        <div>â€¢ writeLogToSpreadsheet: ${diagnosticData.v1Functions.writeLogToSpreadsheet ? 'âœ…' : 'âŒ'}</div>
                    </div>
                    
                    <h4>V2çµ±åˆçŠ¶æ³:</h4>
                    <div style="margin-left: 20px;">
                        <div>â€¢ ${diagnosticData.v2Integration}</div>
                        <div>â€¢ ChatGPT-v2: é€ä¿¡æ™‚åˆ»è¨˜éŒ²æ©Ÿèƒ½è¿½åŠ æ¸ˆã¿</div>
                        <div>â€¢ Claude-v2: é€ä¿¡æ™‚åˆ»è¨˜éŒ²æ©Ÿèƒ½è¿½åŠ æ¸ˆã¿</div>
                        <div>â€¢ Gemini-v2: é€ä¿¡æ™‚åˆ»è¨˜éŒ²æ©Ÿèƒ½è¿½åŠ æ¸ˆã¿</div>
                    </div>
                    
                    ${diagnosticData.systemStats ? `
                    <h4>ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆ:</h4>
                    <div style="margin-left: 20px;">
                        <pre>${JSON.stringify(diagnosticData.systemStats, null, 2)}</pre>
                    </div>` : ''}
                </div>
            `;
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function updateStatus(version, status, message) {
            const statusDiv = document.getElementById(`${version}Status`);
            const indicator = statusDiv.querySelector('.status-indicator');
            
            indicator.className = `status-indicator status-${status}`;
            statusDiv.innerHTML = `<span class="status-indicator status-${status}"></span>${message}`;
        }

        function log(message) {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            resultsDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '<div style="color: #666;">ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>';
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
        window.testState = testState;
        window.getIntegrationDiagnostics = () => {
            return {
                testState,
                diagnosticData: updateDiagnosticInfo,
                systemReady: !!(window.AIHandler && globalThis.spreadsheetLogger)
            };
        };
    </script>
</body>
</html>